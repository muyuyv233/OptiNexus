<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>OptiNexus</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    /* 你的原有 CSS 代码保持不变，只需在最后添加以下样式 */
    .comment-author img.svip-badge {
      height: 1em;
      vertical-align: middle;
      margin-left: 5px;
      transition: transform 0.3s ease;
    }
    .comment-author img.svip-badge:hover {
      transform: scale(1.2);
    }
  </style>
</head>
<body>
  <!-- 你的原有 HTML 结构保持不变 -->
  <script>
    // ===== 新增 SVIP 用户功能 =====
    let svipUsers = []; // 存储SVIP用户名单

    // 获取SVIP用户列表
    async function fetchSvipUsers() {
      try {
        const response = await fetch('https://muyuyv233.github.io/OptiNexus/tag/svip.txt');
        if (!response.ok) throw new Error('获取SVIP列表失败');
        const text = await response.text();
        svipUsers = text.split('\n')
          .map(name => name.trim())
          .filter(name => name.length > 0);
      } catch (error) {
        console.error('获取SVIP用户列表失败:', error);
      }
    }

    // 检查用户是否为SVIP
    function isSvipUser(username) {
      return svipUsers.includes(username);
    }

    // ===== 修改 initialize() 函数 =====
    async function initialize() {
      initTheme();
      await fetchSvipUsers(); // 先加载SVIP名单
      try {
        await Promise.all([
          fetchAnnouncement(),
          fetchReleases(),
          fetchDiscussions()
        ]);
      } catch (error) {
        showErrorNotification(`初始化失败: ${error.message}`);
      }
    }

    // ===== 修改 fetchDiscussions() 函数 =====
    async function fetchDiscussions() {
      try {
        const response = await fetch(`https://api.github.com/repos/muyuyv233/OptiNexus/issues`);
        const issues = await response.json();

        const container = document.getElementById('discussions');
        container.innerHTML = '';
        
        issues.forEach(issue => {
          const issueDiv = document.createElement('div');
          issueDiv.className = 'issue';
          issueDiv.innerHTML = `
            <div class="issue-header">
              <div class="user-info">
                <img src="${issue.user.avatar_url}" class="avatar" alt="${issue.user.login}">
                <div class="user-details">
                  <div class="comment-author">${issue.user.login}${
                    isSvipUser(issue.user.login) ? 
                    ' <img src="https://muyuyv233.github.io/OptiNexus/assets/Svip.png" class="svip-badge" alt="SVIP">' : 
                    ''
                  }</div>
                  <div class="comment-date">${new Date(issue.created_at).toLocaleString()}</div>
                </div>
              </div>
              <h3><i class="fas fa-comment-dots"></i> ${issue.title}</h3>
              <p>${issue.body || '无内容描述'}</p>
              <button class="submit-button" onclick="loadComments(this, ${issue.number})"
                style="margin-top:15px;padding:10px 20px;">
                <i class="fas fa-comments"></i> 显示评论 (${issue.comments})
              </button>
            </div>
            <div class="comments-container" style="display:none;"></div>
          `;
          container.appendChild(issueDiv);
        });
      } catch (error) {
        console.error('获取讨论信息失败:', error);
        showErrorNotification('加载讨论失败，请稍后重试');
      }
    }

    // ===== 修改 loadComments() 函数 =====
    async function loadComments(button, issueNumber) {
      const container = button.parentElement.nextElementSibling;
      if (container.children.length === 0) {
        try {
          button.disabled = true;
          button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> 加载中...';
          
          const response = await fetch(`https://api.github.com/repos/muyuyv233/OptiNexus/issues/${issueNumber}/comments`);
          const comments = await response.json();
          
          container.innerHTML = comments.map(comment => `
            <div class="comment">
              <img src="${comment.user.avatar_url}" class="avatar" alt="${comment.user.login}">
              <div class="comment-content">
                <div class="user-info">
                  <span class="comment-author">${comment.user.login}${
                    isSvipUser(comment.user.login) ? 
                    ' <img src="https://muyuyv233.github.io/OptiNexus/assets/Svip.png" class="svip-badge" alt="SVIP">' : 
                    ''
                  }</span>
                  <span class="comment-date">${new Date(comment.created_at).toLocaleString()}</span>
                </div>
                <div class="comment-body">${comment.body || '无评论内容'}</div>
              </div>
            </div>
          `).join('');
          
          button.innerHTML = `<i class="fas fa-comments"></i> 隐藏评论 (${comments.length})`;
        } catch (error) {
          console.error('获取评论失败:', error);
          container.innerHTML = '<div class="error-text"><i class="fas fa-exclamation-triangle"></i> 无法加载评论</div>';
          button.innerHTML = `<i class="fas fa-comments"></i> 显示评论 (${issueNumber})`;
        } finally {
          button.disabled = false;
        }
      }
      container.style.display = container.style.display === 'none' ? 'block' : 'none';
      button.innerHTML = container.style.display === 'none' ? 
        `<i class="fas fa-comments"></i> 显示评论 (${issueNumber})` : 
        `<i class="fas fa-comments"></i> 隐藏评论 (${issueNumber})`;
    }

    // 你的其他 JavaScript 代码保持不变...
  </script>
</body>
</html>
